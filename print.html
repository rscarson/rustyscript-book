<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Rustyscript Documentation</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="getting_started/index.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="getting_started/hello_world.html"><strong aria-hidden="true">1.1.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="getting_started/calling_functions.html"><strong aria-hidden="true">1.2.</strong> Calling Functions</a></li><li class="chapter-item expanded "><a href="getting_started/errors.html"><strong aria-hidden="true">1.3.</strong> Error Handling</a></li><li class="chapter-item expanded "><a href="getting_started/using_javascript_types_in_rust.html"><strong aria-hidden="true">1.4.</strong> Using JavaScript Types in Rust</a></li><li class="chapter-item expanded "><a href="getting_started/modules.html"><strong aria-hidden="true">1.5.</strong> On Modules and import</a></li><li class="chapter-item expanded "><a href="getting_started/sandbox.html"><strong aria-hidden="true">1.6.</strong> The Sandbox</a></li><li class="chapter-item expanded "><a href="getting_started/runtime_options.html"><strong aria-hidden="true">1.7.</strong> Runtime Options</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="getting_started/extension_options.html"><strong aria-hidden="true">1.7.1.</strong> Extension Options</a></li><li class="spacer"></li></ol></li></ol></li><li class="chapter-item expanded "><a href="advanced/index.html"><strong aria-hidden="true">2.</strong> Advanced Topics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="advanced/asynchronous_javascript.html"><strong aria-hidden="true">2.1.</strong> Asynchronous JavaScript</a></li><li class="chapter-item expanded "><a href="advanced/calling_rust_from_javascript.html"><strong aria-hidden="true">2.2.</strong> Calling Rust from JavaScript</a></li><li class="chapter-item expanded "><a href="advanced/custom_extensions.html"><strong aria-hidden="true">2.3.</strong> Custom Extensions</a></li><li class="chapter-item expanded "><a href="advanced/multithreading.html"><strong aria-hidden="true">2.4.</strong> Multi-Threading</a></li><li class="chapter-item expanded "><a href="advanced/nodejs_compatibility.html"><strong aria-hidden="true">2.5.</strong> NodeJS Compatibility</a></li><li class="chapter-item expanded "><a href="advanced/permissions.html"><strong aria-hidden="true">2.6.</strong> Permissions</a></li><li class="chapter-item expanded "><a href="advanced/snapshots.html"><strong aria-hidden="true">2.7.</strong> Snapshots</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="extensions/index.html"><strong aria-hidden="true">3.</strong> Extensions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="extensions/safe_extensions.html"><strong aria-hidden="true">3.1.</strong> Safe Extensions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="extensions/console.html"><strong aria-hidden="true">3.1.1.</strong> Console</a></li><li class="chapter-item expanded "><a href="extensions/crypto.html"><strong aria-hidden="true">3.1.2.</strong> Crypto</a></li><li class="chapter-item expanded "><a href="extensions/url.html"><strong aria-hidden="true">3.1.3.</strong> Url</a></li><li class="chapter-item expanded "><a href="extensions/web_stub.html"><strong aria-hidden="true">3.1.4.</strong> Web Stub</a></li></ol></li><li class="chapter-item expanded "><a href="extensions/io_extensions.html"><strong aria-hidden="true">3.2.</strong> IO Extensions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="extensions/cache.html"><strong aria-hidden="true">3.2.1.</strong> Cache</a></li><li class="chapter-item expanded "><a href="extensions/cron.html"><strong aria-hidden="true">3.2.2.</strong> Cron</a></li><li class="chapter-item expanded "><a href="extensions/ffi.html"><strong aria-hidden="true">3.2.3.</strong> FFI</a></li><li class="chapter-item expanded "><a href="extensions/fs.html"><strong aria-hidden="true">3.2.4.</strong> FS</a></li><li class="chapter-item expanded "><a href="extensions/io.html"><strong aria-hidden="true">3.2.5.</strong> IO</a></li><li class="chapter-item expanded "><a href="extensions/kv.html"><strong aria-hidden="true">3.2.6.</strong> KV</a></li><li class="chapter-item expanded "><a href="extensions/webgpu.html"><strong aria-hidden="true">3.2.7.</strong> WebGPU</a></li></ol></li><li class="chapter-item expanded "><a href="extensions/network_extensions.html"><strong aria-hidden="true">3.3.</strong> Network Extensions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="extensions/broadcast_channel.html"><strong aria-hidden="true">3.3.1.</strong> Broadcast Channel</a></li><li class="chapter-item expanded "><a href="extensions/http.html"><strong aria-hidden="true">3.3.2.</strong> HTTP</a></li><li class="chapter-item expanded "><a href="extensions/web.html"><strong aria-hidden="true">3.3.3.</strong> Web</a></li><li class="chapter-item expanded "><a href="extensions/websocket.html"><strong aria-hidden="true">3.3.4.</strong> WebSocket</a></li><li class="chapter-item expanded "><a href="extensions/webstorage.html"><strong aria-hidden="true">3.3.5.</strong> WebStorage</a></li></ol></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Rustyscript Documentation</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<p><a href="https://crates.io/crates/rustyscript/"><img src="https://img.shields.io/crates/v/rustyscript.svg" alt="Crates.io" /></a>
<a href="https://github.com/rscarson/rustyscript/actions?query=branch%3Amaster"><img src="https://github.com/rscarson/rustyscript/actions/workflows/tests.yml/badge.svg?branch=master" alt="Build Status" /></a>
<a href="https://docs.rs/rustyscript/latest/rustyscript/"><img src="https://img.shields.io/docsrs/rustyscript" alt="docs.rs" /></a>
<a href="https://rscarson.github.io/rustyscript-book/"><img src="https://img.shields.io/badge/mdbook-user%20guide-blue" alt="Static Badge" /></a>
<a href="https://raw.githubusercontent.com/rscarson/rustyscript/master/LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License" /></a></p>
<h2 id="rustyscript---effortless-js-integration-for-rust"><a class="header" href="#rustyscript---effortless-js-integration-for-rust">Rustyscript - Effortless JS Integration for Rust</a></h2>
<p>rustyscript provides a quick and simple way to integrate a runtime javascript or typescript component from within Rust.</p>
<p>It uses the v8 engine through the <code>deno_core</code> crate, and aims to be as simple as possible to use without sacrificing flexibility or performance.<br />
I also have attempted to abstract away the v8 engine details so you can for the most part operate directly on rust types.</p>
<h3 id="core-principles"><a class="header" href="#core-principles">Core Principles</a></h3>
<h4 id="sandboxed"><a class="header" href="#sandboxed">Sandboxed</a></h4>
<p>By default, the code being run is entirely sandboxed from the host, having no filesystem or network access.
<a href="getting_started/../extensions">extensions</a> can be added to grant additional capabilities that may violate sandboxing</p>
<h4 id="flexible"><a class="header" href="#flexible">Flexible</a></h4>
<p>The runtime is designed to be as flexible as possible, allowing you to modify capabilities, the module loader, and more.</p>
<ul>
<li>Asynchronous JS is fully supported, and the runtime can be configured to run in a multithreaded environment.</li>
<li>Typescript is supported, and will be transpired into JS for execution.</li>
<li>Node JS is supported experimentally, but is not yet fully compatible <a href="getting_started/../advanced/nodejs_compatibility.html">See the NodeJS Compatibility section</a></li>
</ul>
<h3 id="extension-features"><a class="header" href="#extension-features">Extension Features</a></h3>
<p>The crate includes the following features that can be turned on or off as needed:<br />
For a full list of available extensions, see the <a href="getting_started/../extensions">extensions</a> section.</p>
<blockquote>
<p><strong><code>safe_extensions</code></strong> <code>ON BY DEFAULT</code><br />
<code>console</code> <code>crypto</code> <code>url</code> <code>web_stub</code><br />
Deno extensions that maintain a secure, sandboxed runtime environment</p>
</blockquote>
<blockquote>
<p><strong><code>io_extensions</code></strong><br />
<code>web</code> <code>cache</code> <code>cron</code> <code>ffi</code> <code>fs</code> <code>io</code> <code>kv</code> <code>webgpu</code><br />
Deno extensions that grant runtimes access to the file system (but may also grant some level of network access - use caution)</p>
</blockquote>
<blockquote>
<p><strong><code>network_extensions</code></strong><br />
<code>broadcast_channel</code> <code>http</code> <code>web</code> <code>websocket</code> <code>webstorage</code><br />
Deno extensions that grant runtimes access to system network resources</p>
</blockquote>
<blockquote>
<p><strong><code>node_experimental</code></strong><br />
<code>safe_extensions</code> <code>io_extensions</code> <code>network_extensions</code><br />
Experimental NodeJS compatibility</p>
</blockquote>
<h4 id="javascript-isolation-features"><a class="header" href="#javascript-isolation-features">Javascript Isolation Features</a></h4>
<blockquote>
<p><strong><code>url_import</code></strong><br />
Enables executed Javascript to include modules from arbitrary URLs</p>
</blockquote>
<blockquote>
<p><strong><code>fs_import</code></strong><br />
Enables executed Javascript to include modules from the file system, without needing to load them from rust first</p>
</blockquote>
<h4 id="additional-features"><a class="header" href="#additional-features">Additional Features</a></h4>
<blockquote>
<p><strong><code>worker</code></strong> <code>ON BY DEFAULT</code><br />
Enables the multithreaded <a href="https://docs.rs/rustyscript/latest/rustyscript/worker/index.html"><code>worker</code></a> API</p>
</blockquote>
<blockquote>
<p><strong><code>snapshot_builder</code></strong><br />
Enables the <a href="getting_started/../advanced/snapshots.html"><code>snapshot_builder</code></a> API</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started-1"><a class="header" href="#getting-started-1">Getting Started</a></h1>
<h2 id="hello-world"><a class="header" href="#hello-world">Hello World</a></h2>
<p>Here is a very basic use of this crate to execute a JS module. It will:</p>
<ul>
<li>Create a basic runtime</li>
<li>Load a javascript module,</li>
<li>Call a function and the resulting value</li>
</ul>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{Runtime, Module};

fn main() -&gt; Result&lt;(), rustyscript::Error&gt; {
    let module = Module::new(
        &quot;test.js&quot;,
        &quot;
        export default (string) =&gt; {
            console.log(`Hello world: string=${string}`);
            return 2;
        }
        &quot;
    );

    let value: usize = Runtime::execute_module(
        &amp;module, vec![],
        Default::default(),
        &amp;(&quot;test&quot;),
    )?;

    assert_eq!(value, 2);
    Ok(())
}
</code></pre></pre>
<p>Modules can also be loaded from the filesystem with <a href="https://docs.rs/rustyscript/latest/rustyscript/struct.Module.html#method.load"><code>Module::load</code></a> or <a href="https://docs.rs/rustyscript/latest/rustyscript/struct.Module.html#method.load_dir"><code>Module::load_dir</code></a><br />
Or included statically with the <a href="https://docs.rs/rustyscript/latest/rustyscript/macro.module.html"><code>module!</code></a> and <a href="https://docs.rs/rustyscript/latest/rustyscript/macro.include_module.html"><code>include_module!</code></a> macros.</p>
<hr />
<p>Here is a more detailed version example above, which breaks down the steps instead of using the one-liner <a href="https://docs.rs/rustyscript/latest/rustyscript/struct.Runtime.html#method.execute_module"><code>Runtime::execute_module</code></a>:</p>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{Runtime, RuntimeOptions, Module, Undefined};
use std::time::Duration;

fn main() -&gt; Result&lt;(), rustyscript::Error&gt; {
    let module = Module::new(
        &quot;test.js&quot;,
        &quot;
        let internalValue = 0;
        export const load = (value) =&gt; internalValue = value;
        export const getValue = () =&gt; internalValue;
        &quot;
    );

    // Create a new runtime
    let mut runtime = Runtime::new(RuntimeOptions {
        timeout: Duration::from_millis(50), // Stop execution by force after 50ms
        default_entrypoint: Some(&quot;load&quot;.to_string()), // Run this as the entrypoint function if none is registered
        ..Default::default()
    })?;

    // The handle returned is used to get exported functions and values from that module.
    // We then call the entrypoint function, but do not need a return value.
    // Load can be called multiple times, and modules can import other loaded modules
    // Using `import './filename.js'`
    let module_handle = runtime.load_module(&amp;module)?;
    runtime.call_entrypoint::&lt;Undefined&gt;(&amp;module_handle, &amp;(2))?;

    // Functions don't need to be the entrypoint to be callable!
    let _internal_value: i64 = runtime.call_function(Some(&amp;module_handle), &quot;getValue&quot;, &amp;())?;
    Ok(())
}
</code></pre></pre>
<h3 id="single-expression-evaluation"><a class="header" href="#single-expression-evaluation">Single Expression Evaluation</a></h3>
<p>If all you need is the result of a single javascript expression, you can use:</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let result: i64 = rustyscript::evaluate(&quot;5 + 5&quot;).expect(&quot;The expression was invalid!&quot;);
    assert_eq!(result, 10);
}
</code></pre></pre>
<hr />
<p>Or, if you just need to import one Javascript module for use in rust:</p>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{import};

fn main() {
    let mut module = import(&quot;js/my_module.js&quot;).expect(&quot;Something went wrong!&quot;);
    let value: String = module.call(&quot;exported_function_name&quot;, &amp;()).expect(&quot;Could not get a value!&quot;);
    println!(&quot;{value}&quot;);
}
</code></pre></pre>
<p>There are a few other utilities included, such as <a href="https://docs.rs/rustyscript/latest/rustyscript/fn.validate.html"><code>validate</code></a> and <a href="https://docs.rs/rustyscript/latest/rustyscript/fn.resolve_path.html"><code>resolve_path</code></a></p>
<hr />
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started-2"><a class="header" href="#getting-started-2">Getting Started</a></h1>
<h2 id="calling-functions"><a class="header" href="#calling-functions">Calling Functions</a></h2>
<p>You may have noticed the <code>&amp;()</code> in the previous chapter's example - this is because the function <code>getValue</code> does not take any arguments.</p>
<p>Arguments are normally passed as references to tuples, for example:<br />
<code>&amp;(&quot;test&quot;, 1)</code>, <code>&amp;(&quot;test&quot;)</code>, or <code>&amp;()</code></p>
<p>They can be of any combination of types that implement <code>serde::Serialize</code></p>
<p>Arguments can also be references to sized values, such as:<br />
<code>&amp;&quot;test&quot;.to_string()</code> or <code>&amp;1</code></p>
<blockquote>
<p><strong>Important Note:</strong> Up to 16 arguments can be passed in this way<br />
If you need more than 16 arguments, you can use <a href="https://docs.rs/rustyscript/latest/rustyscript/macro.big_json_args.html"><code>big_json_args!</code></a></p>
<p>Please note: This macro is significantly slower â€” benchmark tests show it can be nearly 1,000 times slower than using a smaller argument set. Use sparingly to avoid performance bottlenecks.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started-3"><a class="header" href="#getting-started-3">Getting Started</a></h1>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<p>The crate includes an <a href="https://docs.rs/rustyscript/latest/rustyscript/error/enum.Error.html">error type</a> that can catch any errors that can occur during runtime execution.</p>
<p>A few important variants include:</p>
<blockquote>
<p><code>Error::JsError</code><br />
This is the most common error you will see, and is thrown by the JS runtime. It contains the error message and the stack trace.</p>
</blockquote>
<blockquote>
<p><code>Error::JsonDecode</code><br />
You will see this error if you try to decode a return value to an incompatible type.</p>
</blockquote>
<blockquote>
<p><code>Error::Timeout</code><br />
This error is thrown when runtime execution takes longer than the runtime's configured timeout.</p>
</blockquote>
<blockquote>
<p><code>Error::ValueNotCallable</code><br />
This error is thrown when you try to call a value that is not a function.</p>
</blockquote>
<blockquote>
<p><code>Error::ValueNotFound</code><br />
This error is thrown when you try to access a value that does not exist.</p>
</blockquote>
<hr />
<p>You can get JS-side errors as a code-highlighted string by calling <a href="https://docs.rs/rustyscript/latest/rustyscript/error/enum.Error.html#method.as_highlighted"><code>error.as_highlighted()</code></a></p>
<p>You will get a string of the form:</p>
<pre><code>| let x = 1 + 2  
|       ^  
= Unexpected token '='  
</code></pre>
<p>You can customize this output to include the filename, line or column numbers.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-javascript-types-in-rust"><a class="header" href="#using-javascript-types-in-rust">Using JavaScript Types in Rust</a></h1>
<p>Many functions on a <a href="https://docs.rs/rustyscript/latest/rustyscript/struct.Runtime.html"><code>Runtime</code></a> are generic over a type parameter <code>T</code>, used to specify the expected return type from the executed javascript code.</p>
<ul>
<li>Any type implementing <a href="https://docs.serde.rs/serde/trait.Deserialize.html"><code>Serde::Deserialize</code></a> can be used.</li>
</ul>
<p>Here is a simple example of calling the same function with different return types:</p>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{Runtime, Error};

fn main() -&gt; Result&lt;(), Error&gt; {
    let mut runtime = Runtime::new(Default::default())?;

    let number: i32 = runtime.eval(&quot;1 + 1&quot;)?;
    let string: String = runtime.eval(&quot;1 + 1&quot;)?;
    let float: f64 = runtime.eval(&quot;1 + 1&quot;)?;

    println!(&quot;Number: {}&quot;, number);
    println!(&quot;String: {}&quot;, string);
    println!(&quot;Float: {}&quot;, float);

    Ok(())
}
</code></pre></pre>
<blockquote>
<p>If you don't care about the type of value being returned you can simply use <code>()</code>:</p>
<p>For example, to call a function with side-effects, where no value is returned, you would do:<br />
<code>runtime.eval::&lt;()&gt;(&quot;console.log('Hello, World!')&quot;);</code></p>
<p>Alternatively, if you want the value but do not care about the type, try <a href="https://docs.rs/rustyscript/latest/rustyscript/js_value/enum.Value.html"><code>js_value::Value</code></a></p>
</blockquote>
<h2 id="special-types"><a class="header" href="#special-types">Special Types</a></h2>
<p>The <a href="https://docs.rs/rustyscript/latest/rustyscript/js_value/index.html"><code>js_value</code></a> module defines a number of special types that can be used, which map more-or-less directly to JavaScript types.</p>
<p><strong>It is important to note that all of these cannot outlive their runtime's, or be used on other runtimes</strong></p>
<h3 id="a-hrefhttpsdocsrsrustyscriptlatestrustyscriptjs_valuestructfunctionhtmljs_valuefunctiona"><a class="header" href="#a-hrefhttpsdocsrsrustyscriptlatestrustyscriptjs_valuestructfunctionhtmljs_valuefunctiona"><a href="https://docs.rs/rustyscript/latest/rustyscript/js_value/struct.Function.html"><code>js_value::Function</code></a></a></h3>
<p>A Deserializable javascript function, that can be stored and used later.</p>
<p>Can be called with <a href="https://docs.rs/rustyscript/latest/rustyscript/js_value/struct.Function.html#method.call"><code>Function::call</code></a>.
<code>async</code> and <code>immediate</code> variants exist</p>
<blockquote>
<p>See <a href="getting_started/../advanced/asynchronous_javascript.html">Async JavaScript</a> for details on <code>async</code> and <code>immediate</code>.</p>
</blockquote>
<h3 id="a-hrefhttpsdocsrsrustyscriptlatestrustyscriptjs_valuestructpromisehtmljs_valuepromiseta"><a class="header" href="#a-hrefhttpsdocsrsrustyscriptlatestrustyscriptjs_valuestructpromisehtmljs_valuepromiseta"><a href="https://docs.rs/rustyscript/latest/rustyscript/js_value/struct.Promise.html"><code>js_value::Promise&lt;T&gt;</code></a></a></h3>
<p>A stored javascript promise, that can be resolved or rejected later.</p>
<p>You can turn <code>Promise&lt;T&gt;</code> into <code>Future&lt;Output = T&gt;</code> by calling <code>Promise::into_future</code> This allows you to export multiple concurrent promises without borrowing the runtime mutably</p>
<p>You can also use <code>Promise::into_value</code> to block until the promise is resolved, and get the value.</p>
<h3 id="a-hrefhttpsdocsrsrustyscriptlatestrustyscriptjs_valuestructmaphtmljs_valuemapa"><a class="header" href="#a-hrefhttpsdocsrsrustyscriptlatestrustyscriptjs_valuestructmaphtmljs_valuemapa"><a href="https://docs.rs/rustyscript/latest/rustyscript/js_value/struct.Map.html"><code>js_value::Map</code></a></a></h3>
<p>Read-only instance of a javascript Object. Allows conversion into a <a href="https://doc.rust-lang.org/std/collections/struct.HashMap.html"><code>HashMap</code></a> (Skips any non-utf8 keys).</p>
<p>This type can be faster for large objects than directly deserializing into a rust type.</p>
<h3 id="a-hrefhttpsdocsrsrustyscriptlatestrustyscriptjs_valuestructstringhtmljs_valuestringa"><a class="header" href="#a-hrefhttpsdocsrsrustyscriptlatestrustyscriptjs_valuestructstringhtmljs_valuestringa"><a href="https://docs.rs/rustyscript/latest/rustyscript/js_value/struct.String.html"><code>js_value::String</code></a></a></h3>
<p>A Javascript UTF-16 string, used to preserve data which can be lost converting to a Rust <code>String</code>.</p>
<h3 id="a-hrefhttpsdocsrsrustyscriptlatestrustyscriptjs_valueenumvaluehtmljs_valuevaluea"><a class="header" href="#a-hrefhttpsdocsrsrustyscriptlatestrustyscriptjs_valueenumvaluehtmljs_valuevaluea"><a href="https://docs.rs/rustyscript/latest/rustyscript/js_value/enum.Value.html"><code>js_value::Value</code></a></a></h3>
<p>A generic type able to represent any JavaScript value. This mimics the behavior of the <code>any</code> type in TypeScript.</p>
<p>The primary use-case is to defer the normal type-decoding if the type is not known right away. This is done with <a href="https://docs.rs/rustyscript/latest/rustyscript/js_value/struct.Value.html#method.try_into"><code>Value::try_into</code></a>, which must be called with the same runtime as the value was created with.</p>
<p>It can also be used to directly get the underlying deno value, using <a href="https://docs.rs/rustyscript/latest/rustyscript/js_value/struct.Value.html#method.into_v8"><code>Value::into_v8</code></a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started-4"><a class="header" href="#getting-started-4">Getting Started</a></h1>
<h2 id="on-modules-and-including-them"><a class="header" href="#on-modules-and-including-them">On Modules and Including them</a></h2>
<p>By default, any javascript code can only import modules that have already been loaded with <a href="https://docs.rs/rustyscript/latest/rustyscript/runtime/struct.Runtime.html#method.load_module"><code>Runtime::load_module</code></a>. This is a security feature to prevent arbitrary code from being loaded from the filesystem or network.</p>
<p>However, this can be changed with the <code>fs_import</code> and <code>url_import</code> features. These features allow the runtime to load modules from the filesystem or network respectively.</p>
<h3 id="url-schemes"><a class="header" href="#url-schemes">URL Schemes</a></h3>
<p>Custom URL Schemes can be added to a runtime with the <code>schema_whlist</code> field in the <a href="https://docs.rs/rustyscript/latest/rustyscript/struct.RuntimeOptions.html"><code>RuntimeOptions</code></a> struct.</p>
<ul>
<li><a href="https://github.com/rscarson/rustyscript/blob/master/examples/runtime_extensions.rs">Usage Example</a></li>
</ul>
<h3 id="entrypoints"><a class="header" href="#entrypoints">Entrypoints</a></h3>
<p>When a module is loaded, the runtime will look for a function with the name provided in the <code>default_entrypoint</code> field of the <a href="https://docs.rs/rustyscript/latest/rustyscript/struct.RuntimeOptions.html"><code>RuntimeOptions</code></a> struct, or which is exported as <code>default</code> in the module.</p>
<p>Additionally, you can call <code>rustyscript.register_entrypoint</code> from JS to register a function as an entrypoint at runtime</p>
<p><a href="https://docs.rs/rustyscript/latest/rustyscript/struct.RuntimeOptions.html#method.call_entrypoint"><code>Runtime::call_entrypoint</code></a> will call the entrypoint function with the provided arguments.</p>
<p><a href="https://github.com/rscarson/rustyscript/blob/master/examples/entrypoint_functions.rs">Example 1</a><br />
<a href="https://github.com/rscarson/rustyscript/blob/master/examples/hello_world.rs">Example 2</a></p>
<h3 id="importprovider-trait"><a class="header" href="#importprovider-trait">ImportProvider Trait</a></h3>
<p>The <code>ImportProvider</code> trait can be implemented to provide custom module loading behavior</p>
<ul>
<li>It can be used to implement a cache: <a href="https://github.com/rscarson/rustyscript/blob/master/examples/module_loader_cache.rs">Example</a></li>
<li>Or to provide custom import logic: <a href="https://github.com/rscarson/rustyscript/blob/master/examples/custom_import_logic.rs">Example</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started-5"><a class="header" href="#getting-started-5">Getting Started</a></h1>
<h2 id="the-sandbox"><a class="header" href="#the-sandbox">The Sandbox</a></h2>
<p>One of the guiding principles of <code>rustyscript</code> is to provide a safe sandboxed environment for running JavaScript code by default.</p>
<blockquote>
<p>It should not be possible to access the host system's resources such as the file system, network, or environment variables through JS in the default runtime configuration</p>
</blockquote>
<p>Only the <a href="getting_started/../extensions/safe_extensions.html"><code>safe_extensions</code></a>, <a href="getting_started/../advanced/multithreading.html"><code>worker</code></a>, and <a href="getting_started/../advanced/snapshots.html"><code>snapshot_builder</code></a> features can be enabled without breaking the sandbox.</p>
<p>With the default configuration and crate features, sandboxing is enforced by the following mechanisms:</p>
<ul>
<li><strong>Op safety</strong> - All the ops provided by default have been vetted and whitelisted to ensure they are safe</li>
<li><strong>Import isolation</strong> - The module loader will by default only allow modules that have been loaded with <code>Runtime::load_module</code>
<ul>
<li>A couple of crate features can change this:
<ul>
<li><code>fs_import</code> will allow loading modules from the filesystem</li>
<li><code>url_import</code> will allow loading modules from network location</li>
</ul>
</li>
</ul>
</li>
<li><strong>Extension limiting</strong> - Only a subset of extensions are enabled by default, using a safe stub of the deno_web API
<ul>
<li>See the <a href="getting_started/../extensions/README.html">extensions</a> section for more information on the available optional extensions</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Note:</strong> Extension is a Deno term referring to a subset of the JS standard API.
rustyscript provides these as crate features that can be enabled or disabled at compile time.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started-6"><a class="header" href="#getting-started-6">Getting Started</a></h1>
<h2 id="runtime-options"><a class="header" href="#runtime-options">Runtime Options</a></h2>
<p>To create a runtime, you will need to provide a <a href="https://docs.rs/rustyscript/latest/rustyscript/struct.RuntimeOptions.html"><code>RuntimeOptions</code></a> struct. This struct contains all the configuration options for the runtime, such as the extensions to load, the entrypoint to use, and the maximum heap size.</p>
<p>It implements the <code>Default</code> trait, so you can create a default configuration by calling <code>RuntimeOptions::default()</code>.</p>
<p><code>RuntimeOptions</code> has the following fields:</p>
<h3 id="extensions"><a class="header" href="#extensions"><code>extensions</code></a></h3>
<p>A set of <code>deno_core</code> extensions to add to the runtime<br />
See <a href="getting_started/../advanced/custom_extensions.html">Custom Extensions</a></p>
<h3 id="extension_options"><a class="header" href="#extension_options"><code>extension_options</code></a></h3>
<p>Additional options for the built-in extensions<br />
See <a href="getting_started/extension_options.html">Extension Options</a></p>
<h3 id="default_entrypoint"><a class="header" href="#default_entrypoint"><code>default_entrypoint</code></a></h3>
<p>Function name to use as entrypoint if the module does not explicitely provide one<br />
An entrypoint is a function to be pre-registered for calling from Rust on module load
See <a href="getting_started/modules.html">On Modules and import</a></p>
<h3 id="timeout"><a class="header" href="#timeout"><code>timeout</code></a></h3>
<p>Amount of time to run async tasks before failing.<br />
Only affects blocking functions</p>
<h3 id="max_heap_size"><a class="header" href="#max_heap_size"><code>max_heap_size</code></a></h3>
<p>Maximum heap size for the runtime. The runtime will fail gracefully if this limit is reached</p>
<h3 id="import_provider"><a class="header" href="#import_provider"><code>import_provider</code></a></h3>
<p>Optional import provider for the module loader<br />
Acts as cache, and handler for custom schema prefixes and data sources<br />
See <a href="getting_started/modules.html">On Modules and import</a></p>
<h3 id="startup_snapshot"><a class="header" href="#startup_snapshot"><code>startup_snapshot</code></a></h3>
<p>Optional snapshot to load into the runtime<br />
This will reduce load times, but come with some limitations<br />
See <a href="getting_started/../advanced/snapshots.html">Snapshots</a></p>
<h3 id="isolate_params"><a class="header" href="#isolate_params"><code>isolate_params</code></a></h3>
<p>Optional configuration parameters for building the underlying v8 isolate<br />
This can be used to alter the behavior of the runtime<br />
See <a href="https://docs.rs/v8/130.0.1/v8/struct.CreateParams.html">v8::CreateParams</a> for more information</p>
<h3 id="shared_array_buffer_store"><a class="header" href="#shared_array_buffer_store"><code>shared_array_buffer_store</code></a></h3>
<p>Optional shared array buffer store to use for the runtime<br />
Allows data-sharing between runtimes across threads</p>
<h3 id="schema_whlist"><a class="header" href="#schema_whlist"><code>schema_whlist</code></a></h3>
<p>A whitelist of custom schema prefixes that are allowed to be loaded from javascript<br />
By default only <code>http</code>/<code>https</code> (<code>url_import</code> crate feature), and <code>file</code> (<code>fs_import</code> crate feature) are allowed<br />
See <a href="getting_started/modules.html">On Modules and import</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started-7"><a class="header" href="#getting-started-7">Getting Started</a></h1>
<p><a href="getting_started/runtime_options.html">Back to Runtime Options</a></p>
<h2 id="extension-options"><a class="header" href="#extension-options">Extension Options</a></h2>
<p>The built-in deno extensions have additional options that can be configured when creating a runtime. These options are provided in the<a href="https://docs.rs/rustyscript/latest/rustyscript/struct.ExtensionOptions.html"><code>ExtensionOptions</code></a> struct, which is a field of the <a href="https://docs.rs/rustyscript/latest/rustyscript/struct.RuntimeOptions.html"><code>RuntimeOptions</code></a> struct.</p>
<p>The fields it contains depend on the features enabled in the <code>rustyscript</code> crate. Here is a list of the fields and the features they depend on:</p>
<h3 id="kv_store-a-hrefgetting_startedextensionskvhtmlkva"><a class="header" href="#kv_store-a-hrefgetting_startedextensionskvhtmlkva">kv_store <a href="getting_started/../extensions/kv.html"><code>kv</code></a></a></h3>
<p>Defines the key-value store to use for the <code>deno_kv</code> extension</p>
<h3 id="broadcast_channel-a-hrefgetting_startedextensionsbroadcast_channelhtmlbroadcast_channela"><a class="header" href="#broadcast_channel-a-hrefgetting_startedextensionsbroadcast_channelhtmlbroadcast_channela">broadcast_channel <a href="getting_started/../extensions/broadcast_channel.html"><code>broadcast_channel</code></a></a></h3>
<p>Defines the in-memory broadcast channel to use for the <code>deno_broadcast_channel</code> extension</p>
<h3 id="filesystem-a-hrefgetting_startedextensionsfshtmlfsa"><a class="header" href="#filesystem-a-hrefgetting_startedextensionsfshtmlfsa">filesystem <a href="getting_started/../extensions/fs.html"><code>fs</code></a></a></h3>
<p>Defines the filesystem implementation to use for the <code>deno_fs</code> extension</p>
<ul>
<li>Default is <code>deno_fs::RealFs</code></li>
</ul>
<h3 id="cache-a-hrefgetting_startedextensionscachehtmlcachea"><a class="header" href="#cache-a-hrefgetting_startedextensionscachehtmlcachea">cache <a href="getting_started/../extensions/cache.html"><code>cache</code></a></a></h3>
<p>Defines the cache configuration to use for the <code>deno_cache</code> extension</p>
<ul>
<li>Uses a non-persistent in-memory cache by default</li>
</ul>
<h3 id="webstorage_origin_storage_dir-a-hrefgetting_startedextensionswebstoragehtmlwebstoragea"><a class="header" href="#webstorage_origin_storage_dir-a-hrefgetting_startedextensionswebstoragehtmlwebstoragea">webstorage_origin_storage_dir <a href="getting_started/../extensions/webstorage.html"><code>webstorage</code></a></a></h3>
<p>Defines the directory where the webstorage extension will store its data</p>
<h3 id="io_pipes-a-hrefgetting_startedextensionsiohtmlioa"><a class="header" href="#io_pipes-a-hrefgetting_startedextensionsiohtmlioa">io_pipes <a href="getting_started/../extensions/io.html"><code>io</code></a></a></h3>
<p>Defines the stdin/out/err pipes for the <code>deno_io</code> extension</p>
<h3 id="crypto_seed-a-hrefgetting_startedextensionscryptohtmlcryptoa"><a class="header" href="#crypto_seed-a-hrefgetting_startedextensionscryptohtmlcryptoa">crypto_seed <a href="getting_started/../extensions/crypto.html"><code>crypto</code></a></a></h3>
<p>Defines the seed for the <code>deno_crypto</code> extension</p>
<ul>
<li>Default is <code>None</code></li>
</ul>
<h3 id="node_resolver-a-hrefgetting_startedadvancednodejs_compatibilityhtmlnode_experimentala"><a class="header" href="#node_resolver-a-hrefgetting_startedadvancednodejs_compatibilityhtmlnode_experimentala">node_resolver <a href="getting_started/../advanced/nodejs_compatibility.html"><code>node_experimental</code></a></a></h3>
<p>Defines the package resolver to use for the <code>deno_node</code> extension</p>
<ul>
<li>Default is <code>RustyResolver::new()</code></li>
<li>The <code>RustyResolver</code> type allows you to select the base dir for modules and the filesystem implementation to use</li>
</ul>
<h3 id="web-a-hrefgetting_startedextensionswebhtmlweba"><a class="header" href="#web-a-hrefgetting_startedextensionswebhtmlweba">web <a href="getting_started/../extensions/web.html"><code>web</code></a></a></h3>
<p>Defines the options for the <code>deno_web</code>, <code>deno_fetch</code>, and <code>deno_net</code> extensions</p>
<ul>
<li>Also defines permissions for related APIs</li>
<li>fields:
<ul>
<li><strong>base_url</strong>: Base URL for some <code>deno_web</code> OPs</li>
<li><strong>user_agent</strong>: User agent to use for fetch</li>
<li><strong>root_cert_store_provider</strong>: Root certificate store for TLS connections for fetches and network OPs</li>
<li><strong>proxy</strong>: Proxy for fetch</li>
<li><strong>request_builder_hook</strong>: Request builder hook for fetch</li>
<li><strong>unsafely_ignore_certificate_errors</strong>: List of domain names or IP addresses to ignore SSL errors for</li>
<li><strong>client_cert_chain_and_key</strong>: Client certificate and key for fetch</li>
<li><strong>file_fetch_handler</strong>: File fetch handler for fetch</li>
<li><strong>permissions</strong>: Permissions manager for sandbox-breaking extensions</li>
<li><strong>blob_store</strong>: Blob store for the web related extensions</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="advanced-topics"><a class="header" href="#advanced-topics">Advanced Topics</a></h1>
<p>This chapter will cover more advanced topics that may not be necessary for most users, but can be useful for those who need them.</p>
<p>It will cover:</p>
<ul>
<li><a href="advanced/asynchronous_javascript.html">Managing asynchronous JS, including promises, and background tasks</a></li>
<li><a href="advanced/calling_rust_from_javascript.html">Call sync and async rust from inside the JS runtime, as well as transfering data between the two</a></li>
<li><a href="advanced/custom_extensions.html">Extending the JS runtime with more advanced custom functionality (extensions and op2)</a></li>
<li><a href="advanced/multithreading.html">Running multiple runtimes in parallel, and sharing runtime data between threads</a></li>
<li><a href="advanced/permissions.html">Restricting access from inside a non-sandboxed JS runtime</a></li>
<li><a href="advanced/snapshots.html">Using snapshots to increase startup time</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="asynchronous-javascript"><a class="header" href="#asynchronous-javascript">Asynchronous JavaScript</a></h1>
<p>By default, rustyscript can resolve most asynchronous javascript, including promises, by blocking the current thread.<br />
In many cases, however, this will not be sufficient.<br />
For example, handling ongoing background tasks, dealing with promises, or running async functions in parallel.</p>
<p>To this end, many functions will have <code>_async</code> and <code>_immediate</code> variants.</p>
<h3 id="_async"><a class="header" href="#_async"><code>_async</code></a></h3>
<p><code>_async</code> functions will return a Future that that resolves when:</p>
<ul>
<li>The event loop is resolved, and</li>
<li>If the value is a promise, the promise is resolved</li>
</ul>
<p>For example <code>call_function_async</code> will return a Future that resolves when the function call completes,<br />
And, if the function returns a promise, when the promise is resolved.</p>
<h3 id="_immediate"><a class="header" href="#_immediate"><code>_immediate</code></a></h3>
<p><code>_immediate</code> functions will return a value immediately, but will not resolve promises or advance the event loop.</p>
<ul>
<li>Promises can be returned by specifying the return type as <a href="https://docs.rs/rustyscript/latest/rustyscript/js_value/struct.Promise.html"><code>js_value::Promise</code></a></li>
<li>The event loop should be run using [<code>Runtime::await_event_loop</code>]</li>
</ul>
<p>For example, <code>call_function_immediate</code> on a function returning a promise, will return a <a href="https://docs.rs/rustyscript/latest/rustyscript/js_value/struct.Promise.html"><code>js_value::Promise&lt;T&gt;</code></a> object, which can be resolved later.</p>
<p>You can turn <code>Promise&lt;T&gt;</code> into <code>Future&lt;Output = T&gt;</code> by calling <code>Promise::into_future</code> This allows you to export multiple concurrent promises without borrowing the runtime mutably</p>
<p>You can also use <code>Promise::into_value</code> to block until the promise is resolved, and get the value.</p>
<hr />
<p>A long-form example can be found <a href="https://github.com/rscarson/rustyscript/blob/master/examples/async_javascript.rs">here</a></p>
<h2 id="futures-with-async-functions"><a class="header" href="#futures-with-async-functions">Futures, with async functions</a></h2>
<p>In the example below, we define a simple async function in javascript, and call it from rust.<br />
The runtime's own tokio runtime is used to resolve the future.</p>
<p>The event loop, and the implicit promise resolution, is handled by the runtime, transparently.<br />
This is the simplest way to use async functions.</p>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{Error, Module, Runtime};

fn main() -&gt; Result&lt;(), Error&gt; {
    let module = Module::new(
        &quot;test.js&quot;,
        &quot;
        export const my_func = async () =&gt; 42;
    &quot;,
    );

    // Create a new runtime
    // We don't need to create a tokio runtime, as the runtime will create one for us
    let mut runtime = Runtime::new(Default::default())?;
    let handle = runtime.load_module(&amp;module)?;
    let tokio_runtime = runtime.tokio_runtime();

    // Call the function, and await the result
    let value: u32 = tokio_runtime.block_on(async {
        runtime
            .call_function_async(Some(&amp;handle), &quot;my_func&quot;, &amp;())
            .await
    })?;

    assert_eq!(value, 32);
    Ok(())
}
</code></pre></pre>
<p>Another way is with <a href="https://docs.rs/rustyscript/latest/rustyscript/js_value/struct.Promise.html"><code>js_value::Promise</code></a></p>
<p>Normally, calling a function would resolve the promise. So we need to use <code>call_function_immediate</code> instead.</p>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{js_value::Promise, Error, Module, Runtime};

fn main() -&gt; Result&lt;(), Error&gt; {
    let module = Module::new(
        &quot;test.js&quot;,
        &quot;
        export const my_func = async () =&gt; 42;
    &quot;,
    );

    // Create a new runtime
    let mut runtime = Runtime::new(Default::default())?;
    let handle = runtime.load_module(&amp;module)?;

    // Call the function, and get the promise
    let promise: Promise&lt;u32&gt; = runtime.call_function_immediate(Some(&amp;handle), &quot;my_func&quot;, &amp;())?;

    // Resolve the promise
    // You could instead call `into_future` here, and await it, for a non-blocking version
    let value = promise.into_value(&amp;mut runtime)?;
    assert_eq!(value, 42);

    Ok(())
}
</code></pre></pre>
<h2 id="background-tasks"><a class="header" href="#background-tasks">Background Tasks</a></h2>
<p>Sometimes, a module may begin background tasks, which would tie up the event loop for a long time, causing the <code>async</code> and <code>blocking</code> functions to hang.</p>
<p>In this case, you can use one of the following methods:</p>
<ul>
<li><a href="https://docs.rs/rustyscript/latest/rustyscript/struct.Runtime.html#method.await_event_loop">Runtime::await_event_loop</a></li>
<li><a href="https://docs.rs/rustyscript/latest/rustyscript/struct.Runtime.html#method.block_on_event_loop">Runtime::block_on_event_loop</a></li>
<li><a href="https://docs.rs/rustyscript/latest/rustyscript/struct.Runtime.html#method.advance_event_loop">Runtime::advance_event_loop</a></li>
</ul>
<p>Combined with the <code>immediate</code> variants of most functions, this will allow you full control over execution of the event loop.</p>
<blockquote>
<p>See <a href="https://github.com/rscarson/rustyscript/blob/master/examples/background_tasks.rs">this example</a> for a demonstration.</p>
</blockquote>
<h2 id="threading"><a class="header" href="#threading">Threading</a></h2>
<p>The last way to handle async functions is to use a separate thread.</p>
<blockquote>
<p>See <a href="advanced/../advanced/multithreading.html">Multi-Threading</a> for more information.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="calling-rust-from-javascript"><a class="header" href="#calling-rust-from-javascript">Calling Rust from JavaScript</a></h1>
<p>rustyscript supports registering rust functions to be callable from JavaScript. </p>
<blockquote>
<p>A more advanced and performant way to call rust from JS is through <a href="advanced/./custom_extensions.html">custom extensions</a>.</p>
</blockquote>
<h2 id="blocking-functions"><a class="header" href="#blocking-functions">Blocking Functions</a></h2>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{sync_callback, Error, Runtime};

fn main() -&gt; Result&lt;(), Error&gt; {
    // Let's get a new runtime first
    let mut runtime = Runtime::new(Default::default())?;

    // We can use the helper macro to create a callback
    // It will take care of deserializing arguments and serializing the result
    runtime.register_function(
        &quot;add&quot;,
        sync_callback!(|a: i64, b: i64| {
            a.checked_add(b)
                .ok_or(Error::Runtime(&quot;Overflow&quot;.to_string()))
        }),
    )?;

    // The registered functions can now be called from JavaScript
    runtime.eval::&lt;()&gt;(&quot;rustyscript.functions.add(1, 2)&quot;)?;

    Ok(())
}
</code></pre></pre>
<hr />
<p>Another option is to use a normal function, which can also be <code>move</code> if we want to capture some state:<br />
You will need to handle serialization and deserialization yourself.</p>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{serde_json, Error, Runtime};

fn main() -&gt; Result&lt;(), Error&gt; {
    // Let's get a new runtime first
    let mut runtime = Runtime::new(Default::default())?;

    // We can use a normal function, if we wish
    // It can also be `move` if we want to capture some state
    runtime.register_function(&quot;echo&quot;, |args| {
        // Decode the input
        let input = args
            .first()
            .ok_or(Error::Runtime(&quot;No input&quot;.to_string()))
            .map(|v| serde_json::from_value::&lt;String&gt;(v.clone()))??;

        // Encode the output
        let output = format!(&quot;Hello, {input}!&quot;);
        Ok::&lt;_, Error&gt;(serde_json::Value::String(output))
    })?;

    // The registered functions can now be called from JavaScript
    runtime.eval::&lt;()&gt;(&quot;rustyscript.functions.echo('test')&quot;)?;

    Ok(())
}
</code></pre></pre>
<h2 id="async-functions"><a class="header" href="#async-functions">Async Functions</a></h2>
<p>Async functions can be defined as well:</p>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{async_callback, Error, Runtime};

fn main() -&gt; Result&lt;(), Error&gt; {
    let mut runtime = Runtime::new(Default::default())?;

    // There is also an async version
    runtime.register_async_function(
        &quot;asyncEcho&quot;,
        async_callback!(|input: String| {
            async move { Ok::&lt;_, Error&gt;(format!(&quot;Hello, {input}!&quot;)) }
        }),
    )?;

    // The registered functions can now be called from JavaScript
    runtime.eval::&lt;()&gt;(&quot;rustyscript.async_functions.asyncEcho('test')&quot;)?;

    Ok(())
}
</code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custom-extensions"><a class="header" href="#custom-extensions">Custom Extensions</a></h1>
<blockquote>
<p><strong>Important note:</strong> that the examples in this chapter require your crate to supply the <strong>same version</strong> of <a href="https://crates.io/crates/deno_core"><code>deno_core</code></a> as rustyscript uses - this version can be checked <a href="https://crates.io/crates/rustyscript/latest/dependencies">here</a></p>
</blockquote>
<p>The most performant way to extend rustyscript is to use the <code>extension</code> feature of deno_core.<br />
The following example demonstrates how to create a simple extension that adds two numbers together.</p>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{Error, Runtime, RuntimeOptions};
use deno_core::{extension, op2};

#[op2(fast)]
#[bigint]
fn op_add_example(#[bigint] a: i64, #[bigint] b: i64) -&gt; i64 {
    a + b
}

extension!(
    example_extension,                                  // The name of the extension
    ops = [op_add_example],                             // The ops to include in the extension
    esm_entry_point = &quot;simple_extension.js&quot;,            // The entry point for the extension
    esm = [ dir &quot;js_examples&quot;, &quot;simple_extension.js&quot; ], // The javascript files to include
);

fn main() -&gt; Result&lt;(), Error&gt; {
    // If you were loading from a snapshot, you would use init_ops instead of init_ops_and_esm
    // let my_extension = example_extension::init_ops();
    let my_extension = example_extension::init_ops_and_esm();

    let mut runtime = Runtime::new(RuntimeOptions {
        extensions: vec![my_extension],
        ..Default::default()
    })?;

    let result: i64 = runtime.eval(&quot;my_add(5, 5)&quot;)?;
    assert_eq!(10, result);

    Ok(())
}
</code></pre></pre>
<p>And the corresponding javascript file:</p>
<pre><code class="language-javascript norun">export const add = (a, b) =&gt; Deno.core.ops.op_add_example(a, b);
globalThis.my_add = add;
</code></pre>
<blockquote>
<p><strong>Important note:</strong> All javascript files included in an extension MUST be included somewhere.
I recommend using the file specified in <code>esm_entry_point</code> to include all other files.</p>
</blockquote>
<h2 id="op2"><a class="header" href="#op2">Op2</a></h2>
<p><code>Op2</code> is a deno-provided macro that allows you to define an extension function.</p>
<ul>
<li>The supported types for arguments can be found listed in <a href="https://github.com/denoland/deno_core/blob/main/ops/op2/valid_args.md">https://github.com/denoland/deno_core/blob/main/ops/op2/valid_args.md</a></li>
<li>And return types, here: <a href="https://github.com/denoland/deno_core/blob/main/ops/op2/valid_retvals.md">https://github.com/denoland/deno_core/blob/main/ops/op2/valid_retvals.md</a></li>
</ul>
<p>The <code>fast</code> attribute used when possible to denote that the types involved can be converted fast. Don't stress too much on when to use this, as the compiler will tell you if you need it, or do not.</p>
<p>Ops defined in an extension can then be called from javascript using <code>Deno.core.ops.op_name(args...)</code>.</p>
<hr />
<p>Async functions can be defined as well. </p>
<p>Let us break down a more complex example taken from rustyscript's own internals:</p>
<pre><pre class="playground"><code class="language-rust norun">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[op2(async)]
#[serde]
fn call_registered_function_async(
    #[string] name: String,
    #[serde] args: Vec&lt;serde_json::Value&gt;,
    state: &amp;mut OpState,
) -&gt; impl std::future::Future&lt;Output = Result&lt;serde_json::Value, Error&gt;&gt; {
    if state.has::&lt;AsyncFnCache&gt;() {
        let table = state.borrow_mut::&lt;AsyncFnCache&gt;();
        if let Some(callback) = table.get(&amp;name) {
            return callback(args);
        }
    }

    Box::pin(std::future::ready(Err(Error::ValueNotCallable(name))))
}
<span class="boring">}
</span></code></pre></pre>
<ul>
<li><code>#[op2(async)]</code> is used to denote that this is an async function - it must return a <code>Future</code> of some kind 
<ul>
<li>Potential pitfall: <strong>the returned future cannot have a lifetime</strong></li>
</ul>
</li>
<li><code>#[serde]</code> means that the return value will be a type decoded with <code>serde::Deserialize</code>.
<ul>
<li>In this fase, there return value is <code>Future&lt;Output = Result&lt;serde_json::Value, Error&gt;&gt;</code> - A future that resolves to a <code>serde_json::Value</code>, or an error.</li>
</ul>
</li>
<li>The arguments are annotated with <code>#[string]</code> and <code>#[serde]</code> to denote that they are a string, and a deserializable type, respectively.
<ul>
<li>The <code>state</code> argument is a special case that can be used for persistent storage inside of ops. In this case, it is used to store a cache.</li>
</ul>
</li>
</ul>
<p>And finally, the returned future is run through <code>Box::pin</code> before being returned.</p>
<hr />
<p>You can also customize the names of your extension modules<br />
If you instead define the extension as follows:</p>
<pre><pre class="playground"><code class="language-rust norun">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>extension!(
    example_extension,
    ops = [op_add_example],
    esm_entry_point = &quot;example:calculator&quot;,
    esm = [ dir &quot;examples/example_extension&quot;, &quot;example:calculator&quot; = &quot;example_extension.js&quot; ],
);
<span class="boring">}
</span></code></pre></pre>
<p>Then provide a schema whitelist in your <code>RuntimeOptions</code>:</p>
<pre><pre class="playground"><code class="language-rust norun">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    let mut schema_whlist = HashSet::new();
    schema_whlist.insert(&quot;example:&quot;.to_string());
    options.schema_whlist = schema_whlist;
<span class="boring">}
</span></code></pre></pre>
<p>You would be able to <code>import { add } from &quot;example:calculator&quot;;</code> from inside of your js modules.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multithreading"><a class="header" href="#multithreading">MultiThreading</a></h1>
<p>rustyscript is not thread-safe, due to limitations of the underlying engine, deno_core</p>
<p>The <code>worker</code> feature (enabled by default) gets around this by defining worker threads, which can be used in parallel.<br />
Workers use queries sent over channels to communicate with the main thread.</p>
<blockquote>
<p><strong>Important Note:</strong> You must call <a href="https://docs.rs/rustyscript/latest/rustyscript/fn.init_platform.html"><code>init_platform</code></a> If you are using runtimes on multiple threads.
The only exception is <code>WorkerPool</code>, sen below, which will call <code>init_platform</code> for you.</p>
</blockquote>
<p><a href="https://docs.rs/rustyscript/latest/rustyscript/worker/struct.DefaultWorker.html"><code>DefaultWorker</code></a> is a very simple built-in worker implementation:</p>
<pre><pre class="playground"><code class="language-rust">use deno_core::serde_json;
use rustyscript::{
    worker::{DefaultWorker, DefaultWorkerQuery, DefaultWorkerResponse},
    Error, Module,
};

fn main() -&gt; Result&lt;(), Error&gt; {
    let worker = DefaultWorker::new(Default::default())?;

    // Instruct the worker to load a module
    // We can do with provided helper functions
    let module = Module::new(&quot;test.js&quot;, &quot;export function add(a, b) { return a + b; }&quot;);
    let query = DefaultWorkerQuery::LoadModule(module);
    let response = worker.as_worker().send_and_await(query)?;
    let module_id = if let DefaultWorkerResponse::ModuleId(id) = response {
        id
    } else {
        let e = Error::Runtime(format!(&quot;Unexpected response: {:?}&quot;, response));
        return Err(e);
    };

    // Now we can call the function
    let query = DefaultWorkerQuery::CallFunction(
        Some(module_id),
        &quot;add&quot;.to_string(),
        vec![1.into(), 2.into()],
    );
    let response = worker.as_worker().send_and_await(query)?;
    if let DefaultWorkerResponse::Value(v) = response {
        let value: i32 = serde_json::from_value(v)?;
        assert_eq!(value, 3);
    }

    Ok(())
}
</code></pre></pre>
<blockquote>
<p>Note that the worker has built-in helpers for many operations - this example could be far more succinct using the <code>load_module</code> and <code>call_function</code> helpers,
which take care of the query/response boilerplate, as seen <a href="https://github.com/rscarson/rustyscript/blob/master/examples/default_threaded_worker.rs">here</a>.</p>
</blockquote>
<p>However, for many applications the default worker will not be sufficient, in which case you can implement your own worker - <a href="https://github.com/rscarson/rustyscript/blob/master/examples/custom_threaded_worker.rs">See this example</a></p>
<hr />
<p>The worker module also provides <a href="https://docs.rs/rustyscript/latest/rustyscript/worker/struct.WorkerPool.html"><code>WorkerPool</code></a>, which can be used to manage multiple workers.</p>
<ul>
<li>See <a href="https://github.com/rscarson/rustyscript/blob/master/examples/worker_pool.rs">this example</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nodejs-compatibility"><a class="header" href="#nodejs-compatibility">NodeJS Compatibility</a></h1>
<p>With the <code>node_experimental</code> crate-level feature, you can enable support for some NodeJS APIs. It will also enable all other extension features.</p>
<blockquote>
<p>Please note that this API is highly experimental, and likely does not support all node modules.
Kindly report any issues you encounter.</p>
</blockquote>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>To enable the feature, add <code>node_experimental</code> to the <code>features</code> list in your <code>Cargo.toml</code>.</p>
<p>Node modules will be located in the <code>node_modules</code> directory using the <code>package.json</code> file in the current working directory.</p>
<p>You can import from the node standard library (Deno polyfills)</p>
<ul>
<li>For example <code>import os from &quot;node:os&quot;</code></li>
</ul>
<p>Or from the <code>node_modules</code> directory</p>
<ul>
<li>For example <code>import chalk from &quot;npm:chalk@5&quot;;</code></li>
</ul>
<hr />
<p>See <a href="https://github.com/rscarson/rustyscript/tree/master/examples/node_import">this example</a> for more information.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="permissions"><a class="header" href="#permissions">Permissions</a></h1>
<p>Many of the extension features allow for custom permissions to be set.<br />
This allows for a more fine-grained control over what can be accessed.</p>
<p>This can be done by specifying a value for the <code>permissions: Arc&lt;dyn WebPermissions&gt;,</code> field in <code>RuntimeOptions::web</code>.</p>
<p>The default value is <code>DefaultWebPermissions</code>, which simply allows everything.</p>
<p><a href="https://docs.rs/rustyscript/latest/rustyscript/struct.AllowlistWebPermissionsSet.html"><code>AllowlistWebPermissionsSet</code></a> is also built-in, and allows for specific permissions to be turned on or off:</p>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{AllowlistWebPermissions, Error, Runtime, RuntimeOptions};
use std::sync::Arc;

fn main() -&gt; Result&lt;(), Error&gt; {
    let permissions = Arc::new(AllowlistWebPermissions::default());
    let mut options = RuntimeOptions::default();
    options.extension_options.web.permissions = permissions.clone();

    let mut runtime = Runtime::new(options)?;

    // Fetching any URL will fail
    let result = runtime.eval::&lt;()&gt;(&quot;fetch('https://example.com')&quot;);
    assert!(result.is_err());

    // But if we allow it:
    permissions.allow_url(&quot;https://example.com&quot;);
    let result = runtime.eval::&lt;()&gt;(&quot;fetch('https://example.com')&quot;);
    assert!(result.is_ok());

    Ok(())
}

</code></pre></pre>
<blockquote>
<p>You can also implement the <a href="https://docs.rs/rustyscript/latest/rustyscript/trait.WebPermissions.html"><code>WebPermissions</code></a> trait yourself, and use that instead for even more precise control.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="snapshots"><a class="header" href="#snapshots">Snapshots</a></h1>
<p>Deno's runtime supports the use of memory snapshots to skip the lengthy process of spinning up a new runtime and loading all the necessary code.
This can give gains of ~10x in startup time, but comes with some caveats:</p>
<ul>
<li>The snapshot must be generated on the same system it will be used on</li>
<li>The extensions in the snapshot builder runtime must be the same, and the same order as the runtime that will use the snapshot</li>
<li>The <code>snapshot_builder</code> feature must be enabled on rustyscript - This feature DOES preserve the integrity of the sandbox</li>
</ul>
<h2 id="generating-a-snapshot"><a class="header" href="#generating-a-snapshot">Generating a snapshot</a></h2>
<p>The snapshot must be provided to the runtime via the <code>startup_snapshot</code> field of <a href="https://docs.rs/rustyscript/latest/rustyscript/struct.RuntimeOptions.html"><code>RuntimeOptions</code></a>, which as a type of <code>&amp;'static [u8]</code>.</p>
<p>Therefore the snapshot will typically be created in <code>build.rs</code> (short of using <code>Box::leak</code>, lazy_static, or similar)</p>
<p>The <a href="https://docs.rs/rustyscript/latest/rustyscript/snapshot_builder/struct.SnapshotBuilder.html"><code>SnapshotBuilder</code></a> struct is used to generate the snapshot, and can be used to pre-load modules into the snapshot. It has methods similar to the normal <a href="https://docs.rs/rustyscript/latest/rustyscript/struct.Runtime.html"><code>Runtime</code></a> struct.</p>
<p>Below is a sample that generates a snapshot with a pre-loaded module:</p>
<p>You could also do this in <code>build.rs</code> and write to <code>concat!(env!(&quot;OUT_DIR&quot;), &quot;/snapshot.bin&quot;)</code></p>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{Error, Module, SnapshotBuilder};
use std::fs;

static SNAPSHOT_PATH: &amp;str = &quot;examples/snapshot.bin&quot;;

fn main() -&gt; Result&lt;(), Error&gt; {
    // A module we want pre-loaded into the snapshot
    let module = Module::new(
        &quot;my_module.js&quot;,
        &quot;globalThis.importantFunction = function() {
            return 42;
        }&quot;,
    );

    let snapshot = SnapshotBuilder::new(Default::default())?
        .with_module(&amp;module)?
        .finish();

    fs::write(SNAPSHOT_PATH, snapshot)?;
    Ok(())
}
</code></pre></pre>
<p>Then, in order to use the snapshot:</p>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{Runtime, RuntimeOptions};

static SNAPSHOT: &amp;[u8] = include_bytes!(&quot;example_snapshot.bin&quot;);

fn main() -&gt; Result&lt;(), rustyscript::Error&gt; {
    let mut runtime = Runtime::new(RuntimeOptions {
        startup_snapshot: Some(SNAPSHOT),
        ..Default::default()
    })?;
    let important_value: u32 = runtime.eval(&quot;importantFunction()&quot;)?;
    assert_eq!(important_value, 42);
    Ok(())
    }
</code></pre></pre>
<p>The startup time of the runtime will fall from ~50ms, to less than 1 with the snapshot.</p>
<hr />
<p>You could also generate the snapshot at runtime, in a lazy_static block, or similar:</p>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{Error, Module, Runtime, RuntimeOptions, SnapshotBuilder};
use std::sync::OnceLock;

static SNAPSHOT: OnceLock&lt;Box&lt;[u8]&gt;&gt; = OnceLock::new();
fn get_snapshot() -&gt; &amp;'static [u8] {
    SNAPSHOT.get_or_init(|| {
        let module = Module::new(
            &quot;my_module.js&quot;,
            &quot;globalThis.importantFunction = function() {
            return 42;
        }&quot;,
        );

        SnapshotBuilder::new(Default::default())
            .unwrap()
            .with_module(&amp;module)
            .unwrap()
            .finish()
    })
}

fn main() -&gt; Result&lt;(), Error&gt; {
    let mut runtime = Runtime::new(RuntimeOptions {
        startup_snapshot: Some(get_snapshot()),
        ..Default::default()
    })?;
    runtime.eval::&lt;()&gt;(&quot;1 + 1&quot;)?;
    Ok(())
}

</code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deno-extensions"><a class="header" href="#deno-extensions">Deno Extensions</a></h1>
<p>The Deno JS runtime on which <code>Rustyscript</code> is based boasts very good compatibility with the complete JS standards.</p>
<p>This is done through a series of extensions, listed below, which each provide a part of the full API.<br />
This gives us the ability to use the full JS standard library, or just the parts we need.</p>
<p>By default, <code>Rustyscript</code> includes only those extensions that maintain a secure, sandboxed runtime environment.</p>
<blockquote>
<p>See the <a href="extensions/safe_extensions.html">Safe Extensions</a> section for more information.</p>
</blockquote>
<hr />
<p>Extensions can be activated using crate features, either individually or in groups:</p>
<ul>
<li><a href="extensions/safe_extensions.html"><code>safe_extensions</code></a> - On by default</li>
<li><a href="extensions/io_extensions.html"><code>io_extensions</code></a> - For file system access</li>
<li><a href="extensions/network_extensions.html"><code>network_extensions</code></a> - For network access</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deno-extensions-1"><a class="header" href="#deno-extensions-1">Deno Extensions</a></h1>
<h2 id="safe-extensions"><a class="header" href="#safe-extensions">Safe Extensions</a></h2>
<p>All the extensions mentioned below can be activated using the <code>safe_extensions</code> crate feature.</p>
<p>By default, <code>Rustyscript</code> includes only those extensions that maintain a secure, sandboxed runtime environment.</p>
<blockquote>
<p><strong>Important Note</strong><br />
By default the Javascript code you run have no access to system resources such as the file system, network, or environment variables.</p>
</blockquote>
<p>The safe extensions included by default are:</p>
<ul>
<li><a href="extensions/console.html"><code>console</code></a> - For logging</li>
<li><a href="extensions/crypto.html"><code>crypto</code></a> - For cryptographic functions</li>
<li><a href="extensions/url.html"><code>url</code></a> - For URL parsing</li>
<li><a href="extensions/web_stub.html"><code>web_stub</code></a> - A stub for the <code>web</code> extension, providing timers, and base64 encoding/decoding</li>
</ul>
<p>The remaining extensions can be broadly categorized as either <code>io</code> or <code>network</code>.</p>
<blockquote>
<p><strong>Important Note</strong><br />
With the exception of <a href="extensions/cron.html"><code>cron</code></a>, <a href="extensions/webstorage.html"><code>webstorage</code></a>, and <a href="extensions/ffi.html"><code>ffi</code></a><br />
All the remaining extensions depend on the <a href="extensions/web.html"><code>web</code></a> extension.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="safe-extensions-1"><a class="header" href="#safe-extensions-1">Safe Extensions</a></h1>
<h2 id="console"><a class="header" href="#console">Console</a></h2>
<blockquote>
<p>Crate features: [<code>console</code>, <code>safe_extensions</code>]<br />
<a href="https://crates.io/crates/deno_console/">https://crates.io/crates/deno_console/</a><br />
<a href="https://console.spec.whatwg.org/">https://console.spec.whatwg.org/</a></p>
</blockquote>
<p>Populates the global <code>console</code> object with methods for logging and debugging.<br />
<strong>This extensions is sandbox safe. It is enabled by default.</strong></p>
<h3 id="usage-example"><a class="header" href="#usage-example">Usage Example</a></h3>
<pre><code class="language-js">console.log(&quot;Hello, world!&quot;);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="safe-extensions-2"><a class="header" href="#safe-extensions-2">Safe Extensions</a></h1>
<h2 id="crypto"><a class="header" href="#crypto">Crypto</a></h2>
<blockquote>
<p>Crate features: [<code>crypto</code>, <code>safe_extensions</code>]<br />
<a href="https://crates.io/crates/deno_crypto/">https://crates.io/crates/deno_crypto/</a><br />
<a href="https://www.w3.org/TR/WebCryptoAPI/">https://www.w3.org/TR/WebCryptoAPI/</a></p>
</blockquote>
<p>Populates the global <code>CryptoKey</code>, <code>Crypto</code>, <code>crypto</code>, and <code>SubtleCrypto</code> objects
<strong>This extensions is sandbox safe. It is enabled by default.</strong></p>
<h3 id="options"><a class="header" href="#options">Options</a></h3>
<p><strong><code>RuntimeOptions::extension_options::crypto_seed</code></strong></p>
<ul>
<li>Optional seed the deno_crypto RNG</li>
<li>Default: <code>None</code></li>
</ul>
<p>If a seed is provided, then <a href="https://docs.rs/rand/latest/rand/rngs/struct.StdRng.html"><code>rand::rngs::StdRng</code></a> will be used to generate random numbers.<br />
Otherwise, <a href="https://docs.rs/rand/latest/rand/fn.thread_rng.html"><code>rand::thread_rng</code></a> will be used.</p>
<h3 id="usage-example-1"><a class="header" href="#usage-example-1">Usage Example</a></h3>
<pre><code class="language-js">const key = await crypto.subtle.generateKey(
  {
    name: &quot;AES-GCM&quot;,
    length: 256,
  },
  true,
  [&quot;encrypt&quot;, &quot;decrypt&quot;],
);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="safe-extensions-3"><a class="header" href="#safe-extensions-3">Safe Extensions</a></h1>
<h2 id="url"><a class="header" href="#url">Url</a></h2>
<blockquote>
<p>Crate features: [<code>url</code>, <code>safe_extensions</code>]<br />
<a href="https://crates.io/crates/deno_url/">https://crates.io/crates/deno_url/</a><br />
<a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
<a href="https://wicg.github.io/urlpattern/">https://wicg.github.io/urlpattern/</a></p>
</blockquote>
<p>Populates the global <code>URL</code>, <code>URLPattern</code>, <code>URLSearchParams</code> objects<br />
<strong>This extensions is sandbox safe. It is enabled by default.</strong></p>
<h3 id="usage-example-2"><a class="header" href="#usage-example-2">Usage Example</a></h3>
<pre><code class="language-js">const url = new URL(&quot;https://example.com&quot;);
const pattern = new URLPattern(&quot;https://example.com/*&quot;);
const params = new URLSearchParams(&quot;a=1&amp;b=2&quot;);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="safe-extensions-4"><a class="header" href="#safe-extensions-4">Safe Extensions</a></h1>
<h2 id="web-stub"><a class="header" href="#web-stub">Web Stub</a></h2>
<blockquote>
<p>Crate features: [<code>web_stub</code>, <code>safe_extensions</code>]<br />
Mutually exclusive with the <code>web</code> extension.</p>
</blockquote>
<p><strong>This extensions is sandbox safe. It is enabled by default.</strong></p>
<p>Enables the following from javascript:</p>
<ul>
<li><code>DOMException</code></li>
<li><code>setImmediate</code></li>
<li><code>setInterval</code>, and <code>clearInterval</code></li>
<li><code>setTimeout</code>, and <code>clearTimeout</code></li>
<li><code>atob</code> and <code>btoa</code></li>
</ul>
<h3 id="usage-example-3"><a class="header" href="#usage-example-3">Usage Example:</a></h3>
<pre><code class="language-javascript">const base64 = btoa(&quot;Hello, world!&quot;);
setImmediate(() =&gt; {
  console.log(atob(base64));
});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deno-extensions-2"><a class="header" href="#deno-extensions-2">Deno Extensions</a></h1>
<h2 id="io-extensions"><a class="header" href="#io-extensions">IO Extensions</a></h2>
<p>All the extensions mentioned below can be activated using the <code>io_extensions</code> crate feature.</p>
<p>These extensions grant runtimes access to the file system - but may also grant some level of network access - use caution.</p>
<ul>
<li><a href="extensions/fs.html"><code>fs</code></a> - For file system access</li>
<li><a href="extensions/io.html"><code>io</code></a> - input/output primitives (stdio streams, etc)</li>
<li><a href="extensions/cache.html"><code>cache</code></a> - Cache support, API reference <a href="https://w3c.github.io/ServiceWorker/#cache-interface">here</a></li>
<li><a href="extensions/ffi.html"><code>ffi</code></a> - Deno FFI support</li>
<li><a href="extensions/webgpu.html"><code>webgpu</code></a> - WebGPU support, API reference <a href="https://gpuweb.github.io/gpuweb/">here</a></li>
<li><a href="extensions/kv.html"><code>kv</code></a> - Key-value store, API reference <a href="https://github.com/denoland/denokv/blob/main/proto/kv-connect.md">here</a></li>
<li><a href="extensions/cron.html"><code>cron</code></a> - Implements scheduled tasks (crons) API</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="io-extensions-1"><a class="header" href="#io-extensions-1">IO Extensions</a></h1>
<h2 id="cache"><a class="header" href="#cache">Cache</a></h2>
<blockquote>
<p>Crate features: [<code>cache</code>, <code>io_extensions</code>]<br />
<a href="https://crates.io/crates/deno_cache">https://crates.io/crates/deno_cache</a><br />
<a href="https://w3c.github.io/ServiceWorker/#cache-interface">https://w3c.github.io/ServiceWorker/#cache-interface</a></p>
</blockquote>
<p>Populates the global <code>Cache</code>, <code>CacheStorage</code>, and <code>caches</code> objects.<br />
<strong>Not sandbox safe. Off by default</strong></p>
<blockquote>
<p><strong>Note</strong> <a href="https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions">query options</a> are not yet supported for the <code>Cache.match</code> method.</p>
</blockquote>
<h3 id="options-1"><a class="header" href="#options-1">Options</a></h3>
<p><strong><code>RuntimeOptions::extension_options::cache</code></strong></p>
<ul>
<li>The optional persistent caching backend used by the extension.</li>
<li>Default: A non-persistent, in-memory cache</li>
</ul>
<p>The cache option can also be set to <code>None</code>, which will effectively disable the cache functionality.</p>
<p>To configure the persistent cache, create an instance of the SQLite backend and pass it to the extension:</p>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{CacheBackend, ExtensionOptions, RuntimeOptions};

fn main() {
    // Will store the cache in a directory called &quot;deno_cache&quot;
    let cache = CacheBackend::new_sqlite(&quot;deno_cache&quot;).unwrap();
    let _options = RuntimeOptions {
        extension_options: ExtensionOptions {
            cache: Some(cache),
            ..Default::default()
        },
        ..Default::default()
    };
}
</code></pre></pre>
<h3 id="usage-example-4"><a class="header" href="#usage-example-4">Usage Example</a></h3>
<pre><code class="language-javascript">let cache = await caches.open('my_cache');

fetch('http://web.simmons.edu/').then((response) =&gt; {
    cache.put('http://web.simmons.edu/', response);
});

cache.match('http://web.simmons.edu/').then((response) =&gt; {
    console.log('Got response from cache!');
});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="io-extensions-2"><a class="header" href="#io-extensions-2">IO Extensions</a></h1>
<h2 id="cron"><a class="header" href="#cron">Cron</a></h2>
<blockquote>
<p>Crate features: [<code>cron</code>, <code>io_extensions</code>]<br />
<a href="https://crates.io/crates/deno_cron">https://crates.io/crates/deno_cron</a></p>
</blockquote>
<p>Populates the global <code>Deno.cron</code> object.<br />
<strong>Not sandbox safe. Off by default</strong></p>
<h3 id="usage-example-5"><a class="header" href="#usage-example-5">Usage Example</a></h3>
<pre><code class="language-javascript">let cronHandler = () =&gt; new Promise((resolve) =&gt; {
    console.log('Hello, world!');
    resolve();
});

Deno.cron('my-cron-job', '* * * * *', cronHandler)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="io-extensions-3"><a class="header" href="#io-extensions-3">IO Extensions</a></h1>
<h2 id="ffi"><a class="header" href="#ffi">FFI</a></h2>
<blockquote>
<p>Crate features: [<code>ffi</code>, <code>io_extensions</code>]
<a href="https://crates.io/crates/deno_ffi">https://crates.io/crates/deno_ffi</a></p>
</blockquote>
<p>Populates the <code>Deno.dlopen</code>, <code>Deno.UnsafeCallback</code>, <code>Deno.UnsafePointer</code>, <code>Deno.UnsafePointerView</code>, <code>Deno.UnsafeFnPointer</code> globals
<strong>Not sandbox safe. Off by default</strong></p>
<h3 id="permissions-1"><a class="header" href="#permissions-1">Permissions</a></h3>
<p>This extension is affected by the following methods in the permissions trait:</p>
<ul>
<li><code>check_exec</code> - Check if FFI execution is allowed</li>
<li><code>check_read</code> - Of FFI exec is allowed, check if a specific file is allowed to be read</li>
</ul>
<h3 id="usage-example-6"><a class="header" href="#usage-example-6">Usage Example</a></h3>
<pre><code class="language-javascript">const buffer = new ArrayBuffer(1024);
const baseAddress = Deno.UnsafePointer.value(Deno.UnsafePointer.of(buffer));

const throwCb = () =&gt; throw new Error(&quot;Error&quot;);
const cb = new Deno.UnsafeCallback({
    parameters: [],
    result: &quot;void&quot;,
}, throwCb);

const fnPointer = new Deno.UnsafeFnPointer(cb.pointer, {
    parameters: [],
    result: &quot;void&quot;,
});

assertThrows(() =&gt; fnPointer.call());
cb.close();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="io-extensions-4"><a class="header" href="#io-extensions-4">IO Extensions</a></h1>
<h2 id="fs"><a class="header" href="#fs">FS</a></h2>
<blockquote>
<p>Crate features: [<code>fs</code>, <code>io_extensions</code>]
<a href="https://crates.io/crates/deno_fs">https://crates.io/crates/deno_fs</a></p>
</blockquote>
<p>Populates a large number of filesystem functions under <code>Deno.*</code>:<br />
<strong>Not sandbox safe. Off by default</strong></p>
<p><strong>Full list of functions:</strong><br />
<code>writeFileSync</code> <code>writeFile</code> <code>writeTextFileSync</code> <code>writeTextFile</code> <code>readTextFile</code> <code>readTextFileSync</code> <code>readFile</code> <code>readFileSync</code> <code>watchFs</code> <code>chmodSync</code> <code>chmod</code> <code>chown</code> <code>chownSync</code> <code>copyFileSync</code> <code>cwd</code> <code>makeTempDirSync</code> <code>makeTempDir</code> <code>makeTempFileSync</code> <code>makeTempFile</code> <code>mkdirSync</code> <code>mkdir</code> <code>chdir</code> <code>copyFile</code> <code>readDirSync</code> <code>readDir</code> <code>readLinkSync</code> <code>readLink</code> <code>realPathSync</code> <code>realPath</code> <code>removeSync</code> <code>remove</code> <code>renameSync</code> <code>rename</code> <code>statSync</code> <code>lstatSync</code> <code>stat</code> <code>lstat</code> <code>truncateSync</code> <code>truncate</code> <code>FsFile</code> <code>open</code> <code>openSync</code> <code>create</code> <code>createSync</code> <code>symlink</code> <code>symlinkSync</code> <code>link</code> <code>linkSync</code> <code>utime</code> <code>utimeSync</code> <code>umask</code></p>
<h3 id="permissions-2"><a class="header" href="#permissions-2">Permissions</a></h3>
<p>This extension is affected by the following methods in the permissions trait:</p>
<ul>
<li><code>check_open</code> - Check if a given path is allowed to be opened</li>
</ul>
<hr />
<ul>
<li><code>check_read_all</code> - Can be used to disable all read operations</li>
<li><code>check_read</code> - Check if a given path is allowed to be read</li>
<li><code>check_read_blind</code> - <code>check_read</code>, but is expected to use the <code>display</code> argument to anonymize the path</li>
</ul>
<hr />
<ul>
<li><code>check_write_all</code> - Can be used to disable all write operations</li>
<li><code>check_write</code> - Check if a given path is allowed to be written to</li>
<li><code>check_write_blind</code> - <code>check_write</code>, but is expected to use the <code>display</code> argument to anonymize the path</li>
<li><code>check_write_partial</code> - Used to check if a given path is allowed to be written to partially (non-recursive removes, use this)</li>
</ul>
<h3 id="usage-example-7"><a class="header" href="#usage-example-7">Usage Example</a></h3>
<pre><code class="language-javascript">const file = Deno.openSync(&quot;/dev/zero&quot;);
const buf = new Uint8Array(100);
file.readSync(buf);

const file = Deno.openSync(&quot;/dev/null&quot;, { write: true });
file.writeSync(buf);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="io-extensions-5"><a class="header" href="#io-extensions-5">IO Extensions</a></h1>
<h2 id="io"><a class="header" href="#io">Io</a></h2>
<blockquote>
<p>Crate features: [<code>io</code>, <code>io_extensions</code>]
<a href="https://crates.io/crates/deno_io">https://crates.io/crates/deno_io</a></p>
</blockquote>
<p>Provides low-level Io primitives
Populates the global <code>Deno.SeekMode</code>, <code>Deno.stdin</code>, <code>Deno.stdout</code>, and <code>Deno.stderr</code> objects</p>
<h3 id="options-2"><a class="header" href="#options-2">Options</a></h3>
<p><strong><code>RuntimeOptions::extension_options::io_pipes</code></strong></p>
<ul>
<li>Optional IO pipes to use for stdin, stdout, and stderr</li>
<li>Default: <code>Some(deno_io::Stdio::default())</code></li>
</ul>
<h3 id="usage-example-8"><a class="header" href="#usage-example-8">Usage Example</a></h3>
<pre><code class="language-ts">const encoder = new TextEncoder();
const data = encoder.encode(&quot;Hello world&quot;);
const bytesWritten = await Deno.stdout.write(data); // 11
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="io-extensions-6"><a class="header" href="#io-extensions-6">IO Extensions</a></h1>
<h2 id="kv"><a class="header" href="#kv">KV</a></h2>
<blockquote>
<p>Crate features: [<code>kv</code>, <code>io_extensions</code>]<br />
<a href="https://crates.io/crates/deno_kv">https://crates.io/crates/deno_kv</a><br />
<a href="https://docs.deno.com/deploy/kv/manual">https://docs.deno.com/deploy/kv/manual</a><br />
<a href="https://crates.io/crates/deno_kv#kv-connect">https://crates.io/crates/deno_kv#kv-connect</a><br />
<a href="https://deno.com/deploy">https://deno.com/deploy</a><br />
<a href="https://github.com/denoland/denokv/blob/main/proto/kv-connect.md">https://github.com/denoland/denokv/blob/main/proto/kv-connect.md</a></p>
</blockquote>
<p>Provides a key/value store
Populates the global <code>Deno.openKv</code>, <code>Deno.AtomicOperation</code>, <code>Deno.KvU64</code>, and <code>Deno.KvListIterator</code> objects</p>
<h3 id="options-3"><a class="header" href="#options-3">Options</a></h3>
<p><strong><code>RuntimeOptions::extension_options::kv_store</code></strong><br />
A <a href="https://docs.rs/rustyscript/latest/rustyscript/struct.KvStore.html"><code>KvStore</code></a> defining the store to use for KV operations</p>
<ul>
<li>Default: <code>KvStore::new_local(None, None, KvConfig::default)</code> (An in-memory local store)</li>
</ul>
<h3 id="usage-example-9"><a class="header" href="#usage-example-9">Usage Example</a></h3>
<pre><code class="language-ts">const db = await Deno.openKv();
await db.set([&quot;foo&quot;], &quot;bar&quot;);

const result = await db.get([&quot;foo&quot;]);
result.key; // [&quot;foo&quot;]
result.value; // &quot;bar&quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="io-extensions-7"><a class="header" href="#io-extensions-7">IO Extensions</a></h1>
<h2 id="webgpu"><a class="header" href="#webgpu">WebGPU</a></h2>
<blockquote>
<p>Crate features: [<code>webgpu</code>, <code>io_extensions</code>]<br />
<a href="https://crates.io/crates/deno_webgpu">https://crates.io/crates/deno_webgpu</a><br />
<a href="https://gpuweb.github.io/gpuweb/">https://gpuweb.github.io/gpuweb/</a><br />
<a href="https://github.com/gfx-rs/wgpu">https://github.com/gfx-rs/wgpu</a><br />
<a href="https://gpuweb.github.io/gpuweb/">https://gpuweb.github.io/gpuweb/</a><br />
https://github.com/gpuweb/gpuweb/tree/main/design&gt;<br />
<a href="https://github.com/crowlKats/webgpu-examples">https://github.com/crowlKats/webgpu-examples</a></p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deno-extensions-3"><a class="header" href="#deno-extensions-3">Deno Extensions</a></h1>
<h2 id="network-extensions"><a class="header" href="#network-extensions">Network Extensions</a></h2>
<p>All the extensions mentioned below can be activated using the <code>network_extensions</code> crate feature.</p>
<p>These extensions grant runtimes access to system network resources</p>
<ul>
<li><a href="extensions/web.html"><code>web</code></a> - Timers, events, text encoder/decoder, See <a href="https://w3c.github.io/FileAPI">here</a> and <a href="https://fetch.spec.whatwg.org/">here</a></li>
<li><a href="extensions/webstorage.html"><code>webstorage</code></a> - Web storage API, API reference <a href="https://html.spec.whatwg.org/multipage/webstorage.html">here</a></li>
<li><a href="extensions/websocket.html"><code>websocket</code></a> - Websocket API, API reference <a href="https://websockets.spec.whatwg.org">here</a></li>
<li><a href="extensions/http.html"><code>http</code></a> - Fetch primitives, API reference <a href="https://fetch.spec.whatwg.org/">here</a></li>
<li><a href="extensions/broadcast_channel.html"><code>broadcast_channel</code></a> - Web messaging, API reference <a href="https://html.spec.whatwg.org/multipage/web-messaging.html">here</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="network-extensions-1"><a class="header" href="#network-extensions-1">Network Extensions</a></h1>
<h2 id="broadcast-channel"><a class="header" href="#broadcast-channel">Broadcast Channel</a></h2>
<blockquote>
<p>Crate features: [<code>broadcast_channel</code>, <code>network_extensions</code>]
<a href="https://crates.io/crates/deno_broadcast_channel/">https://crates.io/crates/deno_broadcast_channel/</a><br />
<a href="https://html.spec.whatwg.org/multipage/web-messaging.html">https://html.spec.whatwg.org/multipage/web-messaging.html</a></p>
</blockquote>
<p>Populates the global <code>BroadcastChannel</code> object.<br />
<strong>Not sandbox safe. Off by default</strong></p>
<h3 id="options-4"><a class="header" href="#options-4">Options</a></h3>
<p><strong><code>RuntimeOptions::extension_options::broadcast_channel</code></strong></p>
<ul>
<li>The channel object used by the extension.</li>
<li>Default: <code>InMemoryBroadcastChannel::default()</code></li>
</ul>
<p>The channel can be cloned, and shared between runtimes to communicate between them.</p>
<h3 id="usage-example-10"><a class="header" href="#usage-example-10">Usage Example</a></h3>
<p>Below is an example of using the broadcast_channel extension to transfer data between Rust and JavaScript.
The same technique can be used to communicate between seperate runtimes, by sharing the channel object.</p>
<pre><pre class="playground"><code class="language-rust">use rustyscript::{
    extensions::deno_broadcast_channel::BroadcastChannel, Error, Module, Runtime, RuntimeOptions,
};

fn main() -&gt; Result&lt;(), Error&gt; {
    // Let's extract the channel from the options
    let options = RuntimeOptions::default();
    let channel = options.extension_options.broadcast_channel.clone();

    // Set up our runtime
    let mut runtime = Runtime::new(options)?;
    let tokio_runtime = runtime.tokio_runtime();

    // Load our javascript
    let module = Module::new(
        &quot;test.js&quot;,
        &quot;
        const channel = new BroadcastChannel('my_channel');
        channel.onmessage = (event) =&gt; {
            console.log('Got message: ' + event.data);
            channel.close();
        };
    &quot;,
    );
    tokio_runtime.block_on(runtime.load_module_async(&amp;module))?;
    let resource = channel.subscribe().unwrap();

    // Use a built-in helper function to serialize the data for transmission
    let data: Vec&lt;u8&gt; = runtime.call_function(None, &quot;broadcast_serialize&quot;, &amp;(&quot;foo&quot;))?;
    tokio_runtime.block_on(async {
        channel
            .send(&amp;resource, &quot;my_channel&quot;.to_string(), data)
            .await
            .unwrap();
    });

    // And run the event loop to completion
    runtime.block_on_event_loop(Default::default(), None)?;
    Ok(())
}
</code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="network-extensions-2"><a class="header" href="#network-extensions-2">Network Extensions</a></h1>
<h2 id="http"><a class="header" href="#http">HTTP</a></h2>
<blockquote>
<p>Crate features: [<code>http</code>, <code>network_extensions</code>]<br />
<a href="https://crates.io/crates/deno_http">https://crates.io/crates/deno_http</a><br />
<a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a></p>
</blockquote>
<p>Implements server-side HTTP.<br />
Populates the <code>Deno.serve</code>, <code>Deno.serveHttp</code>, and <code>Deno.upgradeWebSocket</code> functions.<br />
<strong>Not sandbox safe. Off by default</strong></p>
<h3 id="usage-example-11"><a class="header" href="#usage-example-11">Usage Example</a></h3>
<pre><code class="language-ts">Deno.serve((_req: Request) =&gt; {
  return new Response(&quot;Hello, world!&quot;);
});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="web"><a class="header" href="#web">Web</a></h1>
<blockquote>
<p>Crate features: [<code>web</code>, <code>network_extensions</code>, <code>io_extensions</code>]<br />
Mutually exclusive with the <code>web_stub</code> extension.<br />
<a href="https://crates.io/crates/deno_web">https://crates.io/crates/deno_web</a><br />
<a href="https://crates.io/crates/deno_fetch">https://crates.io/crates/deno_fetch</a><br />
<a href="https://crates.io/crates/deno_tls">https://crates.io/crates/deno_tls</a><br />
<a href="https://crates.io/crates/deno_net">https://crates.io/crates/deno_net</a><br />
<a href="https://w3c.github.io/FileAPI">https://w3c.github.io/FileAPI</a><br />
<a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a></p>
</blockquote>
<p>Base Deno web API kit encompassing the <code>deno_web</code>, <code>deno_tls</code>, <code>deno_fetch</code>, and <code>deno_net</code> extensions.</p>
<p>This extension is required by all non-safe extensions.</p>
<blockquote>
<p>The <code>web_stub</code> extension is a minimal subset of this extension, used to instantiate the safe extensions.</p>
</blockquote>
<p>Also populates the following:</p>
<ul>
<li><code>Deno.HttpClient</code> and <code>Deno.createHttpClient</code></li>
<li><code>Deno.connect</code>, <code>Deno.listen</code>, <code>Deno.resolveDns</code>, <code>Deno.listenDatagram</code></li>
<li><code>Deno.connectTls</code>, <code>Deno.listenTls</code>, and <code>Deno.startTls</code></li>
<li><code>Deno.refTimer</code>, and <code>Deno.unrefTimer</code></li>
</ul>
<h3 id="options-5"><a class="header" href="#options-5">Options</a></h3>
<p><strong><code>RuntimeOptions::extension_options::web</code></strong><br />
The <code>WebOptions</code> struct contains the following fields:</p>
<p><code>base_url</code><br />
The base URL to use for relative URL resolution</p>
<ul>
<li>Default: None</li>
</ul>
<p><code>user_agent</code><br />
The user agent string to use for network requests</p>
<ul>
<li>Default: Empty String</li>
</ul>
<p><code>root_cert_store_provider</code><br />
Root certificate store for TLS connections for fetches and network OPs</p>
<ul>
<li>Default: None</li>
</ul>
<p><code>proxy</code><br />
Proxy to provide to fetch operations</p>
<ul>
<li>Default: None</li>
</ul>
<p><code>request_builder_hook</code><br />
Request builder hook for fetch</p>
<ul>
<li>Default: None</li>
</ul>
<p><code>unsafely_ignore_certificate_errors</code><br />
List of domain names or IP addresses for which fetches and network OPs will ignore SSL errors</p>
<ul>
<li>Default: Empty Vec</li>
</ul>
<p><code>client_cert_chain_and_key</code><br />
Client certificate and key for fetch</p>
<ul>
<li>Default: <code>deno_tls::TlsKeys::Null</code></li>
</ul>
<p><code>file_fetch_handler</code><br />
File fetch handler for fetch</p>
<ul>
<li>Default: <code>deno_fetch::DefaultFileFetchHandler</code></li>
</ul>
<p><code>permissions</code><br />
The permissions manager to use for this extension, and several others.<br />
See <a href="extensions/../advanced/permissions.html">Permissions</a> for more information.</p>
<ul>
<li>Default: <code>DefaultWebPermissions</code> (Allows all operations)</li>
</ul>
<p><code>blob_store</code>
The blob store to use for fetch</p>
<ul>
<li>Default: <code>deno_web::BlobStore</code></li>
</ul>
<h3 id="permissions-3"><a class="header" href="#permissions-3">Permissions</a></h3>
<p>Fetch is affected by the following methods in the permissions trait:</p>
<ul>
<li><code>check_url</code> - Check if a given URL is allowed to be fetched</li>
<li><code>check_read</code> - Check if a given path is allowed to be read</li>
</ul>
<p>Net is affected by the following methods in the permissions trait:</p>
<ul>
<li><code>check_host</code> - Check if a given host is allowed to be connected to</li>
<li><code>check_read</code> - Check if a given path is allowed to be read</li>
<li><code>check_write</code> - Check if a given path is allowed to be written to</li>
</ul>
<p>Web is affected by the following methods in the permissions trait:</p>
<ul>
<li><code>allow_hrtime</code> - Allow high-resolution time measurements in timers</li>
</ul>
<h3 id="usage-example-12"><a class="header" href="#usage-example-12">Usage Example</a></h3>
<pre><code class="language-javascript">fetch(&quot;https://example.com/data.json&quot;)
  .then((response) =&gt; response.json())
  .then((data) =&gt; console.log(data));
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="network-extensions-3"><a class="header" href="#network-extensions-3">Network Extensions</a></h1>
<h2 id="websocket"><a class="header" href="#websocket">WebSocket</a></h2>
<blockquote>
<p>Crate features: [<code>websocket</code>, <code>network_extensions</code>]<br />
<a href="https://crates.io/crates/deno_websocket">https://crates.io/crates/deno_websocket</a><br />
<a href="https://html.spec.whatwg.org/multipage/web-sockets.html">https://html.spec.whatwg.org/multipage/web-sockets.html</a></p>
</blockquote>
<p>Populates the global <code>WebSocket</code> and <code>WebSocketStream</code> objects</p>
<h3 id="options-6"><a class="header" href="#options-6">Options</a></h3>
<p>Uses the <code>user_agent</code>, <code>root_cert_store_provider</code>, and <code>unsafely_ignore_certificate_errors</code> fields of <code>RuntimeOptions::extension_options::web</code></p>
<h3 id="permissions-4"><a class="header" href="#permissions-4">Permissions</a></h3>
<p>This extension is affected by the <code>check_url</code> function in the permissions trait, which checks if a given URL is allowed to be accessed</p>
<h3 id="usage-example-13"><a class="header" href="#usage-example-13">Usage Example</a></h3>
<pre><code class="language-ts">const ws = new WebSocket(&quot;ws://localhost:8080&quot;);

ws.onopen = () =&gt; {
  console.log(&quot;Connected&quot;);
  ws.send(&quot;Hello, world!&quot;);
  ws.close();
};
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="io-extensions-8"><a class="header" href="#io-extensions-8">IO Extensions</a></h1>
<h2 id="webstorage"><a class="header" href="#webstorage">WebStorage</a></h2>
<blockquote>
<p>Crate features: [<code>webstorage</code>, <code>io_extensions</code>]
<a href="https://crates.io/crates/deno_webstorage">https://crates.io/crates/deno_webstorage</a>
<a href="https://html.spec.whatwg.org/multipage/webstorage.html">https://html.spec.whatwg.org/multipage/webstorage.html</a></p>
</blockquote>
<p>Populates the global <code>Storage</code>, <code>localStorage</code>, and <code>sessionStorage</code> objects</p>
<h3 id="options-7"><a class="header" href="#options-7">Options</a></h3>
<p><strong><code>RuntimeOptions::extension_options::webstorage_origin_storage_dir</code></strong></p>
<ul>
<li>Optional directory for storage</li>
<li>Default: <code>None</code></li>
</ul>
<p>If a directory is provided, then the storage will be persisted to that directory.<br />
Otherwise, most webstorage operations will be unavailable.</p>
<h3 id="usage-example-14"><a class="header" href="#usage-example-14">Usage Example</a></h3>
<pre><code class="language-js norun">localStorage.setItem(&quot;key&quot;, &quot;value&quot;);
const value = localStorage.getItem(&quot;key&quot;);
console.log(value);
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
                
    </body>
</html>
